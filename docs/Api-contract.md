# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è Telegram RAG-–±–æ—Ç–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–µ—â—ë –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –ª–æ–ª)
1. **URL API**: `http://localhost:8000` (–ª–æ–∫–∞–ª—å–Ω–æ) / `https://–ø–æ–∫–∞-–Ω–µ-–ø—Ä–∏–¥—É–º–∞–ª–∏.ru` (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger**: `http://localhost:8000/docs`

## üìä –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

### ü§ñ 1. RAG-–∑–∞–ø—Ä–æ—Å (–û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π)
**POST** `/api/v1/rag/query`
**Content-Type:** `application/json`
   ```json
   // –ó–∞–ø—Ä–æ—Å (–±–æ—Ç -> —Å–µ—Ä–≤–µ—Ä)
{
  "user_id": 123456789,
  "query_text": "–ß—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ –≤–∑–æ—Ä–≤–∞—Ç—å –µ–∂–∞?",
  "database_id": "db_federal_hedgehogs_laws"
}

// –û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö) (—Å–µ—Ä–≤–µ—Ä -> –±–æ—Ç)
// Status: 200 OK
{
  "answer": "–í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –£–ö –†–§ –∑–∞ –ø–æ–¥—Ä—ã–≤ –µ–∂–∞ –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è...",
  "sources": [
         {
            "title": "–§–ó ‚Ññ123",
            "url": "https://consultant.ru/bla-bla-bla",
            "relevance": 0.95 // —á–∏—Å–ª–æ –æ—Ç 0.0 –¥–æ 1.0
         }
  ]  
}

// –û—Ç–≤–µ—Ç (–æ—à–∏–±–∫–∞) (—Å–µ—Ä–≤–µ—Ä -> –±–æ—Ç)
// Status: 404 Not found
{"detail": "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"}
```

### üîç 2. –ü–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
**POST** `/api/v1/search/documents`
**Content-Type:** `application/json`
```json
// –ó–∞–ø—Ä–æ—Å (–±–æ—Ç -> —Å–µ—Ä–≤–µ—Ä)
{
  "user_id": 123456789,
  "query_text": "–û—Ç–º—ã–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ –∏ –ª–µ–≥–∞–ª–µ–∑–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞...",
  "database_id": "db_legal_docs"
}

// –û—Ç–≤–µ—Ç
// Status: 200 OK
{
  "documents": [
    {
      "title": "–û—Ç—á—ë—Ç –†–æ—Å—Ñ–∏–Ω–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞",
      "url": "rfmt.pdf",
      "relevance": 0.95 // —á–∏—Å–ª–æ –æ—Ç 0.0 –¥–æ 1.0
    }
  ]
}

// –û—Ç–≤–µ—Ç (–æ—à–∏–±–∫–∞) (—Å–µ—Ä–≤–µ—Ä -> –±–æ—Ç)
// Status: 404 Not found
{"detail": "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"}
```

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö db
**GET** **/api/v1/search/databases**
–ø—Ä–∏–º.: –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ -- txt-—Ñ–∞–π–ª —Å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º json'–∞.
–î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–µ —Å –æ–±–µ–∏—Ö –ø–∞–Ω–µ–ª–µ–π –∏–º–µ—é—Ç –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.
```json
// –û—Ç–≤–µ—Ç
// Status: 200 OK
{
  "databases": [
    {
      "database_id": "db_abc123",
      "name": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã",
      "document_count": 150,
      "created_at": "2024-01-15T10:30:00Z"
    },
    {
      "database_id": "db_def456",
      "name": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã", 
      "document_count": 80,
      "created_at": "2024-01-14T09:15:00Z"
    }
  ]
}
```

### (ADMIN) 4. –°–æ–∑–¥–∞–Ω–∏–µ db
**POST** `/api/v1/admin/databases`
**Content-Type:** `application/json`
```json
// –ó–∞–ø—Ä–æ—Å (–±–æ—Ç -> —Å–µ—Ä–≤–µ—Ä)
{
  "user_id": 123456789,
  "name": "–ê—Ä—Ö–∏–≤ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤ –ø—Ä–æ –ø–æ—Ä—É—Ç—á–∏–∫–∞ –†–∂–µ–≤—Å–∫–æ–≥–æ"
}

// –û—Ç–≤–µ—Ç
// Status: 201 Created
{
  "database_id": "id_bla-bla-123",
  "name": "–ê—Ä—Ö–∏–≤ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤ –ø—Ä–æ –ø–æ—Ä—É—Ç—á–∏–∫–∞ –†–∂–µ–≤—Å–∫–æ–≥–æ",
  "status": "created",
  "created_at": "2024-01-15T10:30:00Z"
}

// –û—à–∏–±–∫–∏
// Status: 403 Forbidden
{"detail": "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è"}

// Status: 409 Conflict
{"detail": "–ë–∞–∑–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"}
```

### (ADMIN) 5. –£–¥–∞–ª–µ–Ω–∏–µ db
**DELETE** `/api/v1/admin/databases/db_abc123?user_id=123456789`
```json
// –û—Ç–≤–µ—Ç (–ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–º–µ—Ä)
// Status: 200 OK
{
  "database_id": "db_abc123",
  "name": "ABC",
  "status": "deleted",
  "deleted_documents": 42,
  "deleted_at": "2024-01-15T11:00:00Z"
}

// –û—à–∏–±–∫–∏
// Status: 403 Forbidden
{"detail": "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è"}

// Status: 404 Not found
{"detail": "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"}

// –û—à–∏–±–∫–∏
// Status: 403 Forbidden
{"detail": "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è"}
```

### (ADMIN) 6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ db
**POST** `/api/v1/admin/databases/{database_id}/documents`
**Content-Type:** `multipart/form-data`

–ü–æ–ª—è —Ñ–æ—Ä–º—ã:
- user_id: 123456789
- archive: [—Ñ–∞–π–ª.zip]

```json
// –û—Ç–≤–µ—Ç (–ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–º–µ—Ä)
// Status: 200 OK
{
  "database_id": "db_abc123",
  "processed_files": 15,
  "failed_files": 2,
  "errors": [
    {"file": "corrupted.pdf", "reason": "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å PDF"},
    {"file": "huge_file.mp4", "reason": "–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç"}
  ],
  "total_size_mb": 25.7
}

// –û—à–∏–±–∫–∏
// Status: 403 Forbidden
{"detail": "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è"}

// Status: 422 Unprocessable Entity
{"detail": "–ê—Ä—Ö–∏–≤ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"}
```

## –ü—Ä–æ—á–∏–µ –æ—à–∏–±–∫–∏
```json
// –ö–æ–≥–¥–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π:
// Status: 400 Bad Request
{
  "detail": "–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç: user_id, database_id"
}

// –ö–æ–≥–¥–∞ JSON –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π:
// Status: 400 Bad Request
{
  "detail": "–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞"
}

// –ö–æ–≥–¥–∞ user_id –Ω–µ —á–∏—Å–ª–æ:
// Status: 400 Bad Request
{
  "detail": "user_id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º"
}

// –î–ª—è RAG/search –∑–∞–ø—Ä–æ—Å–æ–≤:
// Status: 422 Unprocessable Entity
{
  "detail": "query_text –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
}

// –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã:
// Status: 422 Unprocessable Entity  
{
  "detail": "–ò–º—è –±–∞–∑—ã –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 3 –¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤"
}

// –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤:
// Status: 422 Unprocessable Entity
{
  "detail": "–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ ZIP, PDF, TXT –∏–ª–∏ DOCX"
}

// –ö–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä —É–º–µ—Ä:
// Status: 500 Internal Server Error
{"detail": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"}
```


## üö® –û—à–∏–±–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã
| –°—Ç–∞—Ç—É—Å | –ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç |
|--------|-----------------|
| 200 | –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| 400 | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö |
| 403 | –ù–µ—Ç –ø—Ä–∞–≤ (–Ω–µ –∞–¥–º–∏–Ω) |
| 404 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ |
| 413 | –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π |
| 422 | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ |
| 500 | –°–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—à–∏–±–∫–∞ |
| 503 | –°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω |

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤

### –ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ù–ï –æ—à–∏–±–∫–∞!)
```json
// RAG-–∑–∞–ø—Ä–æ—Å –±–µ–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
// Status: 200 OK
{
  "answer": "–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
  "sources": []
}

// –ü–æ–∏—Å–∫ –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
// Status: 200 OK  
{
  "documents": []
}

// –£ –∞–¥–º–∏–Ω–∞ –Ω–µ—Ç –±–∞–∑:
// Status: 200 OK
{
  "databases": []
}
